# NONAGA（ノナガ）

> 3つのコマを揃えて勝利を目指す、戦略的アブストラクトゲーム

## 🎮 ゲーム概要

NONAGAは、六角形の盤面で展開される2人対戦型の戦略ゲームです。自分の色のコマ3つを隣接させることを目指しますが、ただコマを動かすだけではありません。毎ターン、コマの移動後に盤面のタイルそのものを動かすことができる—この独特なルールが、深い戦略性と予測不可能な展開を生み出します。

**ゲームの魅力**
- ✨ シンプルなルール、奥深い戦略性
- ⚡ 10〜15分で決着する手軽さ
- 🧠 相手の動きを読み、盤面を操る駆け引き

---

## 📋 ゲームルール

### セットアップ

1. **盤面**: 19個のタイルを六角形状に配置
2. **コマ配置**: 各色3個のコマを、六角形の対角頂点の位置に配置

### 勝利条件

**自分の3つのコマを隣接させたプレイヤーの勝利**

隣接とは、以下のいずれかの形を指します：
- **直線**: 一直線に3つ並ぶ
- **三角形**: 3つが三角形を形成
- **V字**: V字型に配置

### ターンの流れ

各ターンは**2つのアクション**で構成されます（両方必須）：

#### 1️⃣ コマの移動
- 自分のコマを1つ選択
- 直線方向（6方向のいずれか）にスライド移動
- **障害物にぶつかるまで滑り続ける**（途中で止まれない）
- 障害物 = 他のコマ または 盤面の端

#### 2️⃣ タイルの移動
- **コマが乗っていないタイル**を1枚選択
- 別の場所に再配置

**制約条件**：
- 移動後のタイルは**最低2枚のタイルと接触**していること
- タイル移動により**盤面が分断されない**こと（全タイルが繋がったまま）

### 戦略のポイント

- 🎯 自分のコマを有利な位置に配置
- 🚧 相手のコマの足場を奪う
- 🔮 数手先を読んだタイル配置
- ⚖️ 攻めと守りのバランス

---

## 💻 技術仕様（開発者向け）

### システム概要

| 項目 | 内容 |
|------|------|
| **名称** | NONAGA Web |
| **プラットフォーム** | Webブラウザ（レスポンシブ対応） |
| **推奨技術スタック** | React / Next.js + TypeScript |
| **描画** | Canvas API または SVG |
| **状態管理** | Zustand / Redux Toolkit |

### データ構造

#### 座標系
六角形グリッドの管理には**立方座標系（Cube Coordinates）**または**軸座標系（Axial Coordinates）**を採用

```typescript
type HexCoord = { q: number; r: number; s: number }; // 立方座標
type Tile = { coord: HexCoord; occupied: boolean };
type Piece = { player: 'red' | 'blue'; coord: HexCoord };
```

#### 盤面管理
```typescript
interface GameState {
  tiles: Map<string, Tile>;
  pieces: { red: HexCoord[]; blue: HexCoord[] };
  currentPlayer: 'red' | 'blue';
  phase: 'piece-move' | 'tile-move';
}
```

### コアアルゴリズム

#### 1. スライド移動
```
direction_vector = (dq, dr, ds)
current = piece.coord
while (タイルが存在 AND コマが存在しない):
    current = current + direction_vector
return current - direction_vector
```

#### 2. 接続性チェック（重要）
タイル移動の妥当性を検証する最重要アルゴリズム

```
1. 移動予定のタイルを一時的に除外
2. 任意の残存タイルからBFS/DFS探索を開始
3. 全タイル（総数 - 1）に到達できるか確認
4. 到達不可能な場合は移動を拒否
```

#### 3. 勝利判定
```
各ターン終了時:
  player_pieces = [p1, p2, p3]
  if (全てが隣接している):
    return winner
```

### 実装すべき機能

| カテゴリ | 機能 |
|----------|------|
| **ゲーム進行** | フェーズ管理（コマ移動 → タイル移動）|
| **移動制御** | スライド移動の計算、移動可能方向の表示 |
| **バリデーション** | タイル移動の接続性チェック、ルール違反の検出 |
| **勝敗判定** | コマの隣接判定、ゲーム終了処理 |
| **UI/UX** | ドラッグ&ドロップ、移動先ハイライト、アニメーション |
| **その他** | 手番の巻き戻し、盤面のリセット |

### UI/UX要件

- 📱 タッチ操作とマウス操作の両対応
- 🎨 移動可能な場所の視覚的ハイライト
- ✨ スムーズな移動アニメーション
- ⚠️ 不正な操作時の明確なフィードバック
- 📊 現在のフェーズと手番の表示

---

## 🚀 開発のヒント

### 推奨ライブラリ

- **六角形グリッド**: [Honeycomb](https://github.com/flauwekeul/honeycomb) または自前実装
- **描画**: [Konva.js](https://konvajs.org/)（Canvas）、または素のSVG
- **アニメーション**: Framer Motion

### パフォーマンス最適化

- タイルの接続性チェックをメモ化
- Canvas描画時は差分レンダリング
- 大量の座標計算はWeb Workerで並列化

### テストすべき項目

- [ ] 全6方向へのスライド移動
- [ ] タイル移動による盤面分断の防止
- [ ] 各種勝利パターンの判定
- [ ] 不正な操作の拒否
- [ ] エッジケース（角や端での移動）
